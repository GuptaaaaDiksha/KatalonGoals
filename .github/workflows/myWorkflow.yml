name: Katalon Test Execution

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  katalon-test:
    runs-on: ubuntu-latest

    env:
      KATALON_VERSION: 9.2.0
      KATALON_PROJECT_PATH: DemoTest.prj
      KATALON_TEST_SUITE: "Test Suites/DemoSuite"
      BROWSER: "Chrome (headless)"

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Java 17
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '17'

      - name: Install general dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip curl jq xvfb libxi6 libnss3 libxss1 libappindicator3-1 libindicator3-1

      - name: Set up Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: '120'
          install-chromedriver: true
          install-dependencies: true

      - name: Run Katalon tests
        run: |
          ./katalon-execute.sh -noSplash -retry=0 -testSuitePath="Test Suites/DemoSuite" -browserType="Chrome (headless)" -executionProfile="default" -apiKey=${{ secrets.KATALON_API_KEY }} --config -webui.autoUpdateDrivers=true
